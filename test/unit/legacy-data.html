<!doctype html>
<!--
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<html>
<head>
  <meta charset="utf-8">
  <script src="../../../webcomponentsjs/webcomponents-lite.js"></script>
  <script src="../../../web-component-tester/browser.js"></script>
  <link rel="import" href="../../polymer.html">
  <link rel="import" href="../../lib/legacy/legacy-data-mixin.html">
</head>
<body>

  <script>
  </script>
  
  <dom-module id="x-data">
    <script>
      HTMLImports.whenReady(() => {
        Polymer({
          is: 'x-data',
          observers: [
            'static("static")',
            'one(a)',
            'two(b, c)',
            'throws(d)'
          ],
          created() {
            this.one = sinon.spy();
            this.two = sinon.spy();
            this.static = sinon.spy();
          },
          throws() {
            throw new Error('real error');
          }
        });
      });
    </script>
  </dom-module>

  <test-fixture id="declarative-one">
    <x-data a="a"></x-data>
  </test-fixture>

  <test-fixture id="declarative-two">
    <x-data a="a" b="b"></x-data>
  </test-fixture>

  <test-fixture id="declarative-all">
    <x-data a="a" b="b"></x-data>
  </test-fixture>

  <script>
  suite('imperative', () => {
    setup(() => sinon.spy(console, 'warn'));
    teardown(() => console.warn.restore());
    suite('check disabled', () => {
      test('no arguments defined', () => {
        const el = document.createElement('x-data');
        document.body.appendChild(el);
        assert.equal(el.static.callCount, 1);
        assert.equal(el.one.callCount, 0);
        assert.equal(el.two.callCount, 0);
        assert.equal(console.warn.callCount, 0);
        document.body.removeChild(el);
      });
      test('one argument defined', () => {
        const el = document.createElement('x-data');
        el.a = 'a';
        document.body.appendChild(el);
        assert.equal(el.static.callCount, 1);
        assert.equal(el.one.callCount, 1);
        assert.equal(el.two.callCount, 0);
        assert.equal(console.warn.callCount, 0);
        document.body.removeChild(el);
      });
      test('two arguments defined', () => {
        const el = document.createElement('x-data');
        el.a = 'a';
        el.b = 'b';
        document.body.appendChild(el);
        assert.equal(el.static.callCount, 1);
        assert.equal(el.one.callCount, 1);
        assert.equal(el.two.callCount, 1);
        document.body.removeChild(el);
      });
      test('all arguments defined', () => {
        const el = document.createElement('x-data');
        el.a = 'a';
        el.b = 'b';
        el.c = 'c';
        document.body.appendChild(el);
        assert.equal(el.static.callCount, 1);
        assert.equal(el.one.callCount, 1);
        assert.equal(el.two.callCount, 1);
        assert.equal(console.warn.callCount, 0);
        document.body.removeChild(el);
      });
      test('one argument undefined', () => {
        const el = document.createElement('x-data');
        el.a = 'a';
        el.b = 'b';
        el.c = 'c';
        document.body.appendChild(el);
        assert.equal(el.static.callCount, 1);
        assert.equal(el.one.callCount, 1);
        assert.equal(el.two.callCount, 1);
        el.a = undefined;
        assert.equal(el.static.callCount, 1);
        assert.equal(el.one.callCount, 2);
        assert.equal(el.two.callCount, 1);
        assert.equal(console.warn.callCount, 0);
        document.body.removeChild(el);
      });
      test('two arguments undefined', () => {
        const el = document.createElement('x-data');
        el.a = 'a';
        el.b = 'b';
        el.c = 'c';
        document.body.appendChild(el);
        assert.equal(el.static.callCount, 1);
        assert.equal(el.one.callCount, 1);
        assert.equal(el.two.callCount, 1);
        el.a = undefined;
        el.b = undefined;
        assert.equal(el.static.callCount, 1);
        assert.equal(el.one.callCount, 2);
        assert.equal(el.two.callCount, 2);
        assert.equal(console.warn.callCount, 0);
        document.body.removeChild(el);
      });
      test('all arguments undefined', () => {
        const el = document.createElement('x-data');
        el.a = 'a';
        el.b = 'b';
        el.c = 'c';
        document.body.appendChild(el);
        assert.equal(el.static.callCount, 1);
        assert.equal(el.one.callCount, 1);
        assert.equal(el.two.callCount, 1);
        el.a = undefined;
        el.b = undefined;
        el.c = undefined;
        assert.equal(el.static.callCount, 1);
        assert.equal(el.one.callCount, 2);
        assert.equal(el.two.callCount, 3);
        assert.equal(console.warn.callCount, 0);
        document.body.removeChild(el);
      });
    });
    // ------------------------------------------------
    suite('warn', () => {
      test('no arguments defined', () => {
        const el = document.createElement('x-data');
        el._legacyUndefinedCheck = true;
        document.body.appendChild(el);
        assert.equal(el.static.callCount, 1);
        assert.equal(el.one.callCount, 0);
        assert.equal(el.two.callCount, 0);
        assert.equal(console.warn.callCount, 0);
        document.body.removeChild(el);
      });
      test('one argument defined', () => {
        const el = document.createElement('x-data');
        el._legacyUndefinedCheck = true;
        el.a = 'a';
        document.body.appendChild(el);
        assert.equal(el.static.callCount, 1);
        assert.equal(el.one.callCount, 1);
        assert.equal(el.two.callCount, 0);
        assert.equal(console.warn.callCount, 0);
        document.body.removeChild(el);
      });
      test('two arguments defined', () => {
        const el = document.createElement('x-data');
        el._legacyUndefinedCheck = true;
        el.a = 'a';
        el.b = 'b';
        document.body.appendChild(el);
        assert.equal(el.static.callCount, 1);
        assert.equal(el.one.callCount, 1);
        assert.equal(el.two.callCount, 0);
        assert.isTrue(console.warn.calledOnce);
        assert.match(console.warn.firstCall.args[0], /'c' is undefined/);
        document.body.removeChild(el);
      });
      test('all arguments defined', () => {
        const el = document.createElement('x-data');
        el._legacyUndefinedCheck = true;
        el.a = 'a';
        el.b = 'b';
        el.c = 'c';
        document.body.appendChild(el);
        assert.equal(el.static.callCount, 1);
        assert.equal(el.one.callCount, 1);
        assert.equal(el.two.callCount, 1);
        assert.equal(console.warn.callCount, 0);
        document.body.removeChild(el);
      });
      test('one argument undefined', () => {
        const el = document.createElement('x-data');
        el._legacyUndefinedCheck = true;
        el.a = 'a';
        el.b = 'b';
        el.c = 'c';
        document.body.appendChild(el);
        assert.equal(el.static.callCount, 1);
        assert.equal(el.one.callCount, 1);
        assert.equal(el.two.callCount, 1);
        el.a = undefined;
        assert.equal(el.static.callCount, 1);
        assert.equal(el.one.callCount, 2);
        assert.equal(el.two.callCount, 1);
        assert.equal(console.warn.callCount, 0);
        document.body.removeChild(el);
      });
      test('two arguments undefined', () => {
        const el = document.createElement('x-data');
        el._legacyUndefinedCheck = true;
        el.a = 'a';
        el.b = 'b';
        el.c = 'c';
        document.body.appendChild(el);
        assert.equal(el.static.callCount, 1);
        assert.equal(el.one.callCount, 1);
        assert.equal(el.two.callCount, 1);
        el.a = undefined;
        el.b = undefined;
        assert.equal(el.static.callCount, 1);
        assert.equal(el.one.callCount, 2);
        assert.equal(el.two.callCount, 1);
        assert.equal(console.warn.callCount, 1);
        assert.match(console.warn.firstCall.args[0], /'b' is undefined/);
        document.body.removeChild(el);
      });
      test('all arguments undefined', () => {
        const el = document.createElement('x-data');
        el._legacyUndefinedCheck = true;
        el.a = 'a';
        el.b = 'b';
        el.c = 'c';
        document.body.appendChild(el);
        assert.equal(el.static.callCount, 1);
        assert.equal(el.one.callCount, 1);
        assert.equal(el.two.callCount, 1);
        el.a = undefined;
        el.b = undefined;
        el.c = undefined;
        assert.equal(el.static.callCount, 1);
        assert.equal(el.one.callCount, 2);
        assert.equal(el.two.callCount, 1);
        assert.equal(console.warn.callCount, 2);
        assert.match(console.warn.firstCall.args[0], /'b' is undefined/);
        assert.match(console.warn.secondCall.args[0], /'b' is undefined/);
        document.body.removeChild(el);
      });
    });
    suite('other', () => {
      test('real errors still throw', () => {
        const el = document.createElement('x-data');
        document.body.appendChild(el);
        assert.throws(() => {
          el.d = true;
        }, /real error/);
        document.body.removeChild(el);
      });
    });
  });
  </script>
</body>
</html>
